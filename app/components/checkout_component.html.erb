<div class="flex justify-between">
  <h3 class="text-3xl font-bold"><%= t(".checkout") %></h3>
  <div class="bg-gray-100 p-4 rounded-2xl text-right">
    <div class="text-lg font-semibold"><%= active_portfolio.name %></div>
    <div class="text-xs italic"><%= t(".portfolio_number", portfolio_number: active_portfolio.number) %></div>
  </div>
</div>
<div
  class="mt-10 flex"
  data-controller="page-reload toggle-modal paypal-payment card-payment number-of-units"
  data-toggle-modal-modal-value="card-payment"
  data-page-reload-url-value="<%= refresh_path %>"
  data-number-of-units-min-value="<%= tranzaction.minimum_units %>"
  data-number-of-units-max-value="<%= tranzaction.available_units %>"
  data-paypal-payment-paypal-id-value="<%= paypal_client_id %>"
  data-paypal-payment-braintree-authorization-value="<%= braintree_client_authorization %>"
  data-paypal-payment-braintree-prefix-value="<%= braintree_nonce_prefix %>"
  data-paypal-payment-trxn-amount-value="<%= tranzaction.tranzaction_grand_total %>"
  data-card-payment-braintree-authorization-value="<%= braintree_client_authorization %>"
  data-card-payment-braintree-prefix-value="<%= braintree_nonce_prefix %>"
  data-card-payment-trxn-amount-value="<%= tranzaction.tranzaction_grand_total %>"
>
  <div class="w-5/12">
    <%= property_image_with_details %>
  </div>

  <div class="w-7/12 border border-gray-200 p-8 relative">
    <h3 class="text-xl font-bold"><%= t(".review_checkout") %></h3>
    <p class="mt-4">
      <%== t(".review_message", acc_name: active_portfolio.name, units: tranzaction.number_of_units, unit_price: price_per_unit, name: tranzaction.name) %>
    </p>

    <div class="absolute bottom-8 inset-x-8">
      <%= form_with model: tranzaction, scope: tranzaction.scope, url: { action: 'create', controller: :tranzactions },data: {page_reload_target: :form, paypal_payment_target: :form, card_payment_target: :form} do |f|%>
        <div class="flex justify-between">
          <h4 class="text-lg font-semibold text-gray-500"><%= t(".tranzaction_summary") %></h4>
          <div
            class="px-2 py-1 rounded-full text-xs border border-green-500 cursor-pointer hidden hover:bg-green-500 hover:text-white"
            data-number-of-units-target="refreshPriceButton"
            data-action="click->page-reload#refreshWithParams"
          >refresh price</div>
        </div>
        <div>
          <ul class="flex mt-2 divide-x divide-gray-300">
            <li class="bg-gray-200 p-4 w-1/3">
              <div class="text-xs"><%= t(".units_to_acquire") %></div>
              <%= f.number_field :number_of_units,
                step: 1,
                value: tranzaction.number_of_units,
                min: tranzaction.minimum_units,
                max: tranzaction.available_units,
                class: "form-input pl-2",
                autofocus: true,
                data: {
                  action: "input->number-of-units#update reload@window->page-reload#refreshWithParams",
                  paypal_payment_target: "unitsInput",
                  number_of_units_target: "unitsInput"
                }
              %>
            </li>
            <li class="bg-gray-200 p-4 w-1/3">
              <div class="text-xs"><%= t(".subtotal") %></div>
              <div class="text-xl"><%= tranzaction_subtotal %></div>
            </li>
            <li class="bg-gray-200 p-4 w-1/3">
              <div class="text-xs"><%= t(".tranzaction_fee") %></div>
              <div class="text-xl"><%= tranzaction_fee %></div>
            </li>
            <li class="bg-gray-200 p-4 w-1/3">
              <div class="text-xs"><%= t(".grand_total") %></div>
              <div class="text-3xl font-semibold"><%= tranzaction_grand_total %></div>
            </li>
          </ul>
          <div class="flex gap-x-2 mt-4 justify-end items-center">
            <%= render_svg("spinner", class: "icon animate-spin", data: {paypal_payment_target: "spinner"}) %>
            <div class="text-right relative">
              <div id="paypal-button" class="absolute b-0 inset-x-0 opacity-0"></div>
              <%= render Ui::PrimaryButtonComponent.new(
                title: t(".pay_with_paypal"),
                rounded: true,
                full_width: true,
                data: {
                  paypal_payment_target: "payWithPaypalButton",
                  number_of_units_target: "payWithPaypalButton"
                }
              ) %>
            </div>
            <div data-controller="toggle-modal" data-toggle-modal-modal-value="card-payment">
              <%= render Ui::PrimaryButtonComponent.new(
                title: t(".pay_with_card"),
                rounded: true,
                full_width: true,
                data: {
                  action: "toggle-modal#show",
                  paypal_payment_target: "payWithCardButton",
                  number_of_units_target: "payWithCardButton"
                }
              ) %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <%= render CardPaymentModalComponent.new %>
  <%= render PaymentProcessingModalComponent.new %>
</div>
<div class="mt-4 text-gray-500 text-sm">
  Note: We will send you a mail with a copy of the Tenancy in Common agreement for you to sign immediately after payment.
</div>


